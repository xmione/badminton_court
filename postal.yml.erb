# badminton_court/postal.yml.erb
version: 2

postal:
  # Global Postal settings
  web_hostname: <%= ENV['POSTAL_HOST'] %>
  smtp_hostname: <%= ENV['SMTP_HOST'] %>
  use_ip_pools: false
  default_maximum_delivery_attempts: 5
  default_maximum_hold_expiry_days: 1
  default_suppression_list_automatic_removal_days: 30
  default_spam_threshold: 5
  default_spam_failure_threshold: 20
  use_local_ns_for_domain_verification: false
  use_resent_sender_header: true
  signing_key_path: <%= ENV['SIGNING_KEY_PATH'] %>
  smtp_relays: []
  trusted_proxies: []
  queued_message_lock_stale_days: 1
  batch_queued_messages: true

web_server:
  default_port: 5000
  default_bind_address: 0.0.0.0
  max_threads: 5

smtp_server:
  # Configure Postal's own SMTP server for incoming mail
  default_port: <%= ENV['SMTP_PORT'] %>
  default_bind_address: "::"
  default_health_server_port: 9091
  default_health_server_bind_address: 127.0.0.1
  tls_enabled: true
  tls_certificate_path: <%= ENV['SMTP_CERT_PATH'] %>
  tls_private_key_path: <%= ENV['SMTP_KEY_PATH'] %>
  tls_ciphers: 
  ssl_version: SSLv23
  proxy_protocol: false
  log_connections: false
  max_message_size: 14
  log_ip_address_exclusion_matcher: 

main_db:
  host: <%= ENV['POSTAL_DB_HOST'] %>
  port: <%= ENV['POSTAL_DB_PORT'] %>
  username: <%= ENV['POSTAL_DB_USER'] %>
  password: <%= ENV['POSTAL_DB_PASS'] %>
  database: <%= ENV['POSTAL_DB_NAME'] %>
  pool_size: 5
  encoding: utf8mb4
  socket:  # Explicitly set to empty to force TCP connection

message_db:
  host: <%= ENV['MSG_DB_HOST'] %>
  port: <%= ENV['MSG_DB_PORT'] %>
  username: <%= ENV['MSG_DB_USER'] %>
  password: <%= ENV['MSG_DB_PASS'] %>
  database: <%= ENV['MSG_DB_NAME'] %>
  encoding: utf8mb4
  database_name_prefix: postal

smtp:
  # Outbound SMTP settings for sending application-level emails
  host: <%= ENV['SMTP_HOST'] %>
  port: <%= ENV['SMTP_PORT'] %>
  username: <%= ENV['SMTP_USER'] %>
  password: <%= ENV['SMTP_PASS'] %>
  authentication_type: login
  enable_starttls: true
  enable_starttls_auto: true
  openssl_verify_mode: peer
  from_name: <%= ENV['SMTP_FROM_NAME'] %>
  from_address: <%= ENV['SMTP_FROM_EMAIL'] %>

rails:
  environment: production
  secret_key: <%= ENV['RAILS_SECRET_KEY'] || ENV['AUTH_SECRET'] %>
  allowed_hosts: 
    - localhost
    - 127.0.0.1